<div export replace>
    <p style="margin: 2em">
        Use the following form to create your Arcano application.<br />
        Input your values and download your configuration file and JAR.
    </p>
    <div style="min-height: 500px" class="card">
        <div class="card-content">
            <PrimaryButton style="float:right" class="card-title activator">
                <i class="material-icons">more_vert</i>
            </PrimaryButton>
            <span class="card-title">
                <i style="font-size: 1.2em;position:relative;top: 0.2em" class="material-icons">
                    description
                </i>
                Application Configuration
            </span>
            <div id="form" class="cols-2">
                <InputField ref="appname" label="Name" type="text">
                    Name of your application
                </InputField>
                <InputField ref="port" label="Port" type="number">
                    The port number your server should be listening to.<br />
                    This is usually set to <b>80</b> for HTTP or <b>443</b> for HTTPS.<br />
                </InputField>
                <InputField ref="bindAddress" label="Bind Address">
                    The interfaces your server should bind to, this is usually an IP address.<br />
                    <hr />
                    <div class="left-text">
                        You can use the notation <b>0.0.0.0</b> to tell your server<br />
                        to bind on <b>all</b> available <b>IPv4</b> interfaces, or the notation <b>::</b> to<br />
                        tell your server to bind on <b>all</b> available <b>IPv4 or IPv6</b> interfaces.
                    </div>
                </InputField>
                <InputField ref="webRoot" label="Web Root">
                    This is the root of your application.<br />
                    <hr />
                    <div class="left-text">
                        Clients won't be able to access the parent directory of their <br />
                        root through any kind of request unless you make a <br />
                        specific <b>HttpController</b> (in Java)<br />
                        or <b>script</b> (in JavaScript) that does it.
                    </div>
                </InputField>
                <InputField ref="entryPoint" label="Entry Point">
                    This is the file that will be served by your server whenever<br />
                    a client requests the <b>root</b> resource.<br />
                    <hr>
                    <div class="left-text">
                        Let's say the <b>Entry Point</b> is set to <b>/index.html</b><br />
                        Example:<br />
                        Client requests <b>http://127.0.0.1/</b><br />
                        Server responds the contents of the <b>$webRoot/index.html</b> file.<br />
                
                        The <b>Entry Point</b> file is relative to the <b>Web Root</b> location.
                    </div>
                </InputField>
                <InputField ref="charset" label="Charset">
                    This is the charset your server will be using.<br />
                    This ios by default set to <b>UTF-8</b>.
                </InputField>
                <InputField ref="timeout" label="timeout" type="number">
                    This defines how long (<b>milliseconds</b>) the server should wait for a client<br />
                    that is not sending any data before closing the connection.
                </InputField>
                <InputField ref="sessionTTL" label="Session TTL" type="number">
                    This defines how long (<b>seconds</b>) a session should live.
                </InputField>
                <InputField ref="webSocketMTU" label="WS MTU" type="number">
                    This is the Maximum Transmission Unit for WebSockets, which defines<br />
                    how large in size is the single largest frame <b>sent</b> to the <br />
                    client or <b>received</b> from the client.
                    <hr />
                    <div class="left-text">
                        This doesn't mean you can't receive messages <b>larger than</b> this <br />
                        <b>value</b> or that the incoming messages will be <b>split</b> in more pieces.<br />
                        This value "<i>simply</i>" tells the server how many bytes to read or write at once.
                    </div>
                </InputField>
                <InputField ref="httpMTU" label="Http MTU" type="number">
                    This is the Maximum Transmission Unit for Http request, which defines <br />
                    how large in size is the single largest frame <b>sent</b> to the <br />
                    client or <b>received</b> from the client.
                </InputField>
                <InputField ref="threadPoolSize" label="Thread Pool Size" type="number">
                    This is the size of your Thread Pool.<br />
                    <hr />
                    "By maintaining a pool of threads, the model increases<br />
                     performance and avoids latency in execution due to <br />
                     frequent creation and destruction of threads for <br />
                     short-lived tasks."<br />
                     <br />
                     <span style="float: right"><i>- Wikipedia</i></span>
                </InputField>
                <div></div>
                <CheckBox ref="sendExceptions" label="Send Exceptions" checked="checked">
                    Check this if you want your server to send detailed information <br />
                    to the client whenever an Exception (that is not internally catched) <br />
                    triggers inside a controller.
                </CheckBox>
                <CheckBox ref="responseWrapper" label="Response Wrapper">
                    Check this if you want your server to wrap all <br />
                    the response messages in  JavaScript Object Notation (JSON)
                </CheckBox>
                
            </div><br />
            <hr />
            <div style="position: relative;">
                <a id="sendingAnimation" style="cursor: default;position:absolute;left:47%;right:47%;display: none;" class="btn-floating pulse">
                    <i class="material-icons">cloud_queue</i>
                </a>
                <PrimaryButton id="download" style="position: absolute; left: 35%;right:35%;text-align: center;">
                    <span id="downloadText">Download</span>
                </PrimaryButton>
                <script>
                    download.addEventListener("click",async ()=>{
                        let tmp = {
                            port: form.ref("port").value(),
                            bindAddress: form.ref("bindAddress").value().trim(),
                            webRoot: form.ref("webRoot").value().trim(),
                            entryPoint: form.ref("entryPoint").value().trim(),
                            charset: form.ref("charset").value().trim(),
                            timeout: form.ref("timeout").value(),
                            sessionTTL: form.ref("sessionTTL").value(),
                            webSocketMTU: form.ref("webSocketMTU").value(),
                            httpMTU: form.ref("httpMTU").value(),
                            threadPoolSize: form.ref("threadPoolSize").value(),
                            sendExceptions: form.ref("sendExceptions").value(),
                            responseWrapper: form.ref("responseWrapper").value()
                        };

                        if(tmp.port === null)
                            tmp.port = null;
                        if(tmp.bindAddress === "")
                            tmp.bindAddress = null;
                        if(tmp.webRoot === "")
                            tmp.webRoot = "www";
                        if(tmp.entryPoint === "")
                            tmp.entryPoint = "index.html";
                        if(tmp.charset === "")
                            tmp.charset = null;
                        if(tmp.timeout === null)
                            tmp.timeout = null;
                        if(tmp.sessionTTL === null)
                            tmp.sessionTTL = null;
                        if(tmp.webSocketMTU === null)
                            tmp.webSocketMTU = null;
                        if(tmp.httpMTU === null)
                            tmp.httpMTU = null;
                        if(tmp.threadPoolSize === null)
                            tmp.threadPoolSize = null;
                        if(!tmp.responseWrapper)
                            tmp.responseWrapper = null;
                        let data = {};
                        Object.keys(tmp).map(key => {
                            if(tmp[key] !== null)
                                data[key] = tmp[key];
                        });

                        console.log(data);

                        let content = JSON.stringify(data);
                        download.style.display="none";
                        sendingAnimation.style.display="";
                        const request = await fetch("/create",{
                            method: "POST",
                            body: content
                        });
                        const blob = await request.blob();
                        const b64 = window.URL.createObjectURL(blob);
                        const a = create("a");
                        a.href = b64;
                        let filename = form.ref("appname").value().trim();
                        a.download = (filename===""?"app":filename)+".zip";
                        a.click();
                        window.URL.revokeObjectURL(b64);
                        download.style.display="";
                        sendingAnimation.style.display="none";
                    });
                </script>
            </div>
            <br />
        </div>
        <div class="card-reveal">
            <PrimaryButton style="float:right" class="card-title">
                <i class="material-icons">close</i>
            </PrimaryButton>
            <div style="padding: 1em">
                This feature is not yet available.
            </div>
        </div>
    </div>
</div>
